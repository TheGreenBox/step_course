\part{ Основные определения }
Максимальная частота приемистотости - максимальная управляющая частота, при которой не нагруженный
двигатель может останавливаться и запускаться без пропуска шагов.

Максимальная выходная чатота вращения - максимальная шаговая частота вращения, при которой
ненагруженный двигатель может двигаться без пропуска шагов.

Максимальный пусковой момент - максимальный момент сопротивления нагрузки, с которой двигатель может
запускаться и сохранять синхронность при частоте импульсов в 10 Гц.

\part{ Основные формулы }

Если не учитывать насыщение магнитной системы, то справедливо равенство \cite[стр. 82]{Chilikin}:

\begin{equation}
\label{step_motor_torque_common}
    M(\theta)
    = \frac{dW_r}{d\theta_m}
    = p \frac{dW_s}{d\theta}
    = \frac{1}{2} p I_s \frac{dL_s}{d\theta}
        + \frac{1}{2} p I_r \frac{dL_r}{d\theta}
        + \frac{1}{2} p I_{s} I_r \frac{dL_{sr}}{d\theta}
\end{equation}

$I_{s}, I_{r}$ - установившееся значение токов статора и ротора соответсвенно

$L_{s}(\theta)$ - индуктивность статора

$L_{r}(\theta)$ - индуктивность ротора

$L_{sr}(\theta)$ - взаимоиндукция ротора и статора

Частота собственных упругих колебаний ротора \cite[гл 3.1]{Chilikin} при малых отклонениях от положения устойчивого
положения позволяет получить сторогую оценку механической подвижности системы и является ее мерой.

\begin{equation}
\label{step_motor_torque_without_load_and_with_unstable_rotor}
    M(\theta)
    = - M_{m} \sin{\theta}
    = - M_{m} \sin{p\theta_{M}}
\end{equation}

\begin{equation}
\label{step_motor_dynamic_move_equation}
    J \ddot{ \theta_{M} } + M_{m} \sin{p \theta_{M}} = 0
\end{equation}

При малых отклонениях от положения равновесия таких что:
\begin{equation}
    \sin{\theta} \thickapprox 0
\end{equation}

\begin{equation}
    \label{rotor_like_harmonical_oscilator_equation}
    \ddot{\theta} + \frac{p M_{m}}{J} \theta = 0
\end{equation}

\begin{equation}
    \label{friquent_for_rotor_self_oscilating}
    \omega = \sqrt{\frac{p M_{m}}{J}}
\end{equation}

Процесс изменения тока в обмотке шагового двигателя при ШИМ-управлении \cite[гл. 6.4, стр. 239]{Chilikin}:

Для случая $0 \le \varepsilon \le \zeta$:
\begin{equation}
    \label{winding_current_with_pwm_control_1}
    i[n ; \varepsilon] =
        \frac{ U_{1} }{ R }
            \cdot \{ 1
                 -\frac { e^{ -\sigma \cdot \varepsilon } }
                        { 1 - e^{-\sigma} }
                    \cdot [ (1 - e^{-n\sigma})
                              - e^{ -(1 - \zeta) \cdot \sigma }
                                    \cdot ( 1 - e^{-n\sigma + \sigma} )
                          ]
              \}
        -\frac{ U_2 }{ R }
            \cdot \frac {e^{-\sigma}} {1 - e^{-\sigma}}
            \cdot ( 1 - e^{ -n \cdot \sigma + \sigma } )
            \cdot ( 1 - e^{ -\sigma + \sigma \cdot \zeta } )
\end{equation}

Для случая $\zeta \le \varepsilon \le 1$:
\begin{equation}
    \label{winding_current_with_pwm_control_0}
    i[n; \varepsilon] =
        \frac{ U_{1} + U_{2} }{ R }
            \cdot \frac{ 1 }{ 1 - e^{-\sigma} }
            \cdot (1 - e^{-\sigma\zeta})
            \cdot (1 - e^{-n\sigma})e^{-\sigma\varepsilon + \sigma\zeta} 
        - \frac{ U_{2} }{ R }
            \cdot [ 1 - e^{ -( n - 1 + \varepsilon - \zeta ) \sigma }]

\end{equation}

$\varepsilon = \frac{ t }{ T_{y} }$

$\zeta = \frac{ t_{1} }{ T_{y} }$

$\sigma = \frac{ T }{ T_{y} }$

$T = \frac{ L }{ R }$

$n$ - число периодов импульсов напряжения

$t_{1}$ - время подачи напряжения внутри импульса, сек

$T_{y}$ - период ШИМ, сек

$t$ - текущее время, сек

\newpage
\part{ Управление без ОС }

Передаточная функция шагового двигателя для одного шага при управлении источником тока \cite[гл. 4.2, ф-ла 4.65]{Kenio}, с помощью которой можно определить пороговую частоту переключения обмоток, после которой двигатель выходит из синхронизма при управлении без обратной связи:

\begin{equation}
    \label{step_motor_transfer_function}
    G(s) = \frac{ \omega_{np}^{2} }
                { s^{2} + \frac{D}{J} \cdot s + \omega_{np}^{2} }

\end{equation}

Собственная частота вращения ротора \cite[гл. 4.2, ф-ла 4.48]{Kenio}

\begin{equation}
    \label{rotor_natural_frequency}
    \omega_{np} = \sqrt{\frac{N_{r}K_{T}I_{o}}{J}}
\end{equation}

Постоянная момента, выраженная из \cite[гл. 4.2, ф-ла 4.52]{Kenio}, при условии линейности характеристики $r = f(\delta\theta)$

\begin{equation}
    \label{torque_coeff}
    K_{T} = \frac{N_{r}I_{o}\delta\theta}{\tau}
\end{equation}

$N_{r} = 100$ - число зубцов ротора,

$I_{o}$ - ток якоря, А

$\tau$ - статический момент удержания, Н$\cdot$м

$\delta\theta$ - отклонение от положения равновесия, рад.
\newline\newline

Вычислим $K_{T}$ в положении, в котором момент удержания максимален. В первом приближении он достигается при отклонении от положения равновесия $\delta\theta = \frac{\pi}{2}$.

Тогда, подставляя паспортные данные $\tau = 0,9$ Н$\cdot$м, $I_{o} = 3$ А в (\ref{torque_coeff}), получим:
\begin{equation}
    \label{first_approximation_moment_coeff}
    K_{T} = 2\cdot10^{-3}
\end{equation}

Подставляя (\ref{first_approximation_moment_coeff}) в (\ref{rotor_natural_frequency}), получим:
\begin{equation}
    \label{first_approximation_rotor_natural_frequency}
    \omega_{np} = 1,118 \cdot 10^{2}
\end{equation}

\newpage
\part{ Управление с ОС }

Момент шагового двигателя в зависимости от угла отклонения ротора от положения равновесия:
\begin{equation}
    \label{torque_from_rotor_deviation}
    \tau = K_{T} I_{M} N_{r} ( \theta_{i} - \theta_{0} )
\end{equation}

$K_{T}$ - см. (\ref{torque_coeff})

$I_{M}$ - ток в обмотке, А

$N_{r} = 100$ - число зубцов ротора

$\theta_{0}$ - положение ровновесия, рад.

$\theta_{i}$ - текущее угловое положение, рад.
\newline\newline
С помощью (\ref{torque_from_rotor_deviation}), задав желаемый угол коммутации и средний (среднеинтегральный) момент, можно получить значение желаемого среднего (среднеинтегрального) тока и с помощью (\ref{winding_current_with_pwm_control_1}) и (\ref{winding_current_with_pwm_control_0}) получить коэффициент заполнения ШИМ, необходимый для поддержания на данном шаге заданного момента.

\newpage
\part{ Моделирование в MATLAB }
Для моделирования процессов, протекающих в системе, воспользуемся пакетом MATLAB. Перед построением модели всей системы, необходимо получить все параметры, необходимые для использования встроенной модели гибридного шагового двигателя. Известно всё необходимое, за исключением величины потосцепления, формируемого постоянными магнитами ротора. Его можно определить по формуле из \cite{Matlab_help_stepper_motor}:

\begin{equation}
    \label{maximum_flux_linkage}
    \psi_{M} = \frac{30}{\pi p} E_{M} N
\end{equation}

$N$ - частота вращения ротора, об/мин

$p = \frac{360}{2m \cdot step}$

$m = 2$ - число фаз шагового двигателя

$step = 1,8$ - шаг углового перемещения шагового двигателя, град

$E_{M}$ - амплитудное значение ЭДС самоиндукции разомнутой обмотки статора, В

Для использования (\ref{maximum_flux_linkage}) проведём следующий эксперимент: с помощью дополнительного двигателя на стенде разгоним интересующий нас шаговый двигатель до частоты вращения $N = const$ и с помощью осцилографа определим $E_{M}$ в одной из его разомкнутых обмоток.

\endinput
